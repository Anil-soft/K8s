ğŸ“Œ What Are Logs?
Logs are detailed, textual records of events or activities generated by an application, service, or system. They provide contextual and chronological information about what happened at a specific moment. Logs are typically unstructured or semi-structured text.

ğŸ”¹ Key Characteristics of Logs
âœ” Granular Detail â€“ Each log entry captures a specific event.
âœ” Chronological â€“ Logs record events in the order they occur.

ğŸ”¹ Examples of Logs
ğŸ“Œ Web Server Logs
ğŸ“„ Log Message:
2024-12-17T10:15:00Z INFO 200 GET /api/v1/users
ğŸ”¹ Describes a successful HTTP GET request to the /api/v1/users endpoint.

ğŸ“Œ Application Logs
ğŸ“„ Log Message:
2024-12-17T10:16:45Z ERROR Unable to connect to database: Connection timed out
ğŸ”¹ Indicates an error when attempting to connect to a database.

ğŸ“Œ What Are Metrics?
Metrics are quantitative measurements that provide a real-time, numerical summary of the state or performance of a system, application, or infrastructure. Metrics are structured and lightweight.

ğŸ”¹ Key Characteristics of Metrics
âœ” Numerical and Structured â€“ Expressed as numbers.
âœ” Aggregated â€“ Represent summaries like averages, counts, or rates.

ğŸ”¹ Examples of Metrics
ğŸ“Œ CPU Usage
ğŸ–¥ Metric Name: cpu_utilization
ğŸ“Š Value: 75%
ğŸ”¹ Tracks how much CPU is being utilized.

ğŸ“Œ Request Latency
â³ Metric Name: http_request_duration_seconds
ğŸ“Š Value: 0.250s
ğŸ”¹ Measures the time taken to handle an HTTP request.

ğŸ“Œ Error Rate
ğŸš¨ Metric Name: http_5xx_errors_total
ğŸ“Š Value: 15
ğŸ”¹ Counts the total number of 5xx server errors.

ğŸ“Œ Key Differences Between Logs and Metrics
ğŸ”¹ Logs:
Unstructured or semi-structured textual data.
Provides detailed context for troubleshooting.
Used for debugging issues, auditing, and event correlation.
ğŸ”¹ Metrics:
Structured, numerical data.
Tracks performance trends and system health over time.
Used for real-time monitoring, alerting, and capacity planning.

ğŸ“Œ How They Work Together
âœ… Metrics Alert You â€“ Show anomalies (e.g., high error rates, latency).
âœ… Logs Explain Why â€“ Provide detailed insights to debug and fix the issue.

1ï¸âƒ£ What is Node Exporter?
ğŸ”¹ Node Exporter is used to collect system-level metrics such as:
CPU, memory, disk, network usage
Filesystem statistics
System load, I/O operations
ğŸ“Œ It runs as a DaemonSet, meaning it is deployed on every node in the cluster.

2ï¸âƒ£ What is Kube State Metrics?
ğŸ”¹ Kube State Metrics is used to collect Kubernetes object-level metrics such as:
Pod, Deployment, ReplicaSet statuses
Node status & conditions
Resource requests/limits
PersistentVolume statuses
ğŸ“Œ It provides metrics only about Kubernetes resources, not system metrics.

3ï¸âƒ£ Deployment in Kubernetes
ğŸ“Œ Deploying Node Exporter
Since Node Exporter collects node-level metrics, it should be deployed as a DaemonSet.

ğŸ“Œ node-exporter.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-exporter
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: node-exporter
  template:
    metadata:
      labels:
        app: node-exporter
    spec:
      containers:
      - name: node-exporter
        image: prom/node-exporter:latest
        ports:
        - containerPort: 9100
          hostPort: 9100
ğŸ“Œ How it Works?
Runs on every node.
Exposes metrics on http://<node-ip>:9100/metrics.
Metrics include CPU, memory, disk, and system health.

ğŸ“Œ Deploying Kube State Metrics
Kube State Metrics is deployed as a Deployment.
ğŸ“Œ kube-state-metrics.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kube-state-metrics
  namespace: monitoring
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kube-state-metrics
  template:
    metadata:
      labels:
        app: kube-state-metrics
    spec:
      containers:
      - name: kube-state-metrics
        image: quay.io/coreos/kube-state-metrics:latest
        ports:
        - containerPort: 8080
ğŸ“Œ How it Works?
Runs as a single instance.
Exposes metrics on http://<pod-ip>:8080/metrics.
Provides Kubernetes object metrics (Pods, Deployments, Nodes, etc.)

4ï¸âƒ£ How Prometheus Scrapes Metrics?
ğŸ”¹ Prometheus scrapes metrics from:
Node Exporter (http://node-exporter:9100/metrics)
Kube State Metrics (http://kube-state-metrics:8080/metrics)
ğŸ“Œ prometheus-config.yaml
scrape_configs:
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  - job_name: 'kube-state-metrics'
    static_configs:
      - targets: ['kube-state-metrics:8080']
ğŸ“Œ How it Works?5ï¸âƒ£ Storing & Visualizing Metrics
ğŸ“Œ Storage in Prometheus

Stored in Prometheusâ€™s time-series database (TSDB).
Data retention depends on Prometheus configuration.
ğŸ“Œ Visualizing in Grafana
Grafana queries Prometheus as a data source.
Dashboards are created for Node metrics & Kubernetes metrics.
Prometheus queries both exporters every few seconds.
Stores the metrics in time-series format.
Grafana can visualize these metrics.

âœ… Check Node Exporter metrics
curl http://<node-ip>:9100/metrics

âœ… Check Kube State Metrics
kubectl port-forward svc/kube-state-metrics 8080:8080 -n monitoring
curl http://localhost:8080/metrics

1ï¸âƒ£ Create a ConfigMap for Prometheus Configuration
The best practice is to store the Prometheus configuration inside a Kubernetes ConfigMap.

ğŸ“Œ Create prometheus-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s

    scrape_configs:
      - job_name: 'node-exporter'
        static_configs:
          - targets: ['node-exporter:9100']

      - job_name: 'kube-state-metrics'
        static_configs:
          - targets: ['kube-state-metrics:8080']

2ï¸âƒ£ Mount the ConfigMap Inside the Prometheus Deployment
After creating the ConfigMap, we need to mount it inside the Prometheus Deployment.

ğŸ“Œ Modify Prometheus Deployment to Use the ConfigMap
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus
  namespace: monitoring
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      labels:
        app: prometheus
    spec:
      containers:
      - name: prometheus
        image: prom/prometheus:latest
        args:
          - "--config.file=/etc/prometheus/prometheus.yml"
        volumeMounts:
          - name: prometheus-config
            mountPath: /etc/prometheus
            subPath: prometheus.yml
      volumes:
        - name: prometheus-config
          configMap:
            name: prometheus-config

How node-exporter and kube-state-metrics Collect Metrics?
Both node-exporter and kube-state-metrics are Prometheus exporters that collect different types of metrics from a Kubernetes cluster.

1ï¸âƒ£ How node-exporter Collects Metrics
ğŸ“Œ What it does?

Runs on every Kubernetes Node as a DaemonSet.
Fetches system-level metrics like:
CPU usage
Memory consumption
Disk I/O
Network statistics
ğŸ“Œ How it works?

node-exporter runs as a containerized agent on each node.
It collects system metrics by reading /proc and /sys files inside the node.
The metrics are exposed at http://<node-ip>:9100/metrics
Prometheus scrapes these metrics by hitting the /metrics endpoint.

ğŸ“Œ Deploy node-exporter DaemonSet
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-exporter
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: node-exporter
  template:
    metadata:
      labels:
        app: node-exporter
    spec:
      containers:
      - name: node-exporter
        image: prom/node-exporter:latest
        ports:
        - containerPort: 9100

2ï¸âƒ£ How kube-state-metrics Collects Metrics
ğŸ“Œ What it does?

Does not collect system metrics like CPU/memory.
Instead, it gathers Kubernetes object status:
Number of running Pods
Deployment replicas
Node conditions (Ready/NotReady)
Persistent Volume status

ğŸ“Œ How it works?
kube-state-metrics connects to the Kubernetes API server.
It fetches metadata and status of cluster objects (Pods, Deployments, Nodes, etc.).
The metrics are exposed at http://<kube-state-metrics-IP>:8080/metrics
Prometheus scrapes these metrics from this endpoint.
ğŸ“Œ Deploy kube-state-metrics
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kube-state-metrics
  namespace: monitoring
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kube-state-metrics
  template:
    metadata:
      labels:
        app: kube-state-metrics
    spec:
      containers:
      - name: kube-state-metrics
        image: k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.5.0
        ports:
        - containerPort: 8080



























